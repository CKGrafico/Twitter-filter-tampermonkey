// GPLv2 Licensed
// http://www.gnu.org/licenses/gpl-2.0.html
//
// ==UserScript==
// @name            Twitter-Filter
// @description     Active filter on twitter
// @namespace       http://ckgrafico.com
// @version         0.1.1
// @author          CKGrafico
// @include         https://www.twitter.com*
// @include         https://twitter.com*
// @include         http://www.twitter.com*
// @include         http://twitter.com*
// @resource        styles https://raw.githubusercontent.com/CKGrafico/Twitter-filter-tampermonkey/master/build/min/all.min.css
// @run-at          document-end
// @require         http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js
// ==/UserScript==

!function(t,e){function n(){localStorage.setItem("ckFilters",JSON.stringify({words:e("#ck-input-words").val(),accounts:e("#ck-input-accounts").val()}))}function a(){return JSON.parse(localStorage.getItem("ckFilters"))}t.getData=a,t.saveData=n}(this,jQuery),function(t,e){function n(){e(".ck-filter-close, .ck-filters").on("click",o),e(".ck-save").on("click",l)}function a(){var t=e(".js-global-actions"),n=e("<li/>").addClass("ck-filters"),a=e("<a/>").addClass("js-nav").attr("href","#").attr("title","Filter"),i=e("<span/>").addClass("Icon Icon--newsBadge Icon--large"),o=e("<span/>").addClass("text").text("Filters");n.append(a.append(i).append(o)).appendTo(t)}function i(){var n=t.getData();$container=e("<div/>").addClass("modal-container ck-filter-container"),$close=e("<div/>").addClass("close-modal-background-target ck-filter-close"),$modal=e("<div/>").addClass("modal-content ck-modal-content"),$h2=e("<h2/>").text("Filters configuration"),$save=e("<button/>").addClass("small-follow-btn follow-btn btn small ck-save").text("Save");var a=r({label:"Twitter accounts",name:"accounts",placeholder:"Charles, twitter, hater",description:"Write twitter accounts to exclude",value:n.accounts||""}),i=r({label:"Specific words",name:"words",placeholder:"hello, money, idiot",description:"Write specific words to exclude",value:n.words||""});$modal.append($h2).append(a).append(i).append($save),$container.append($close).append($modal),e("body").append($container)}function o(t){t&&t.preventDefault();var n="block";"block"===e(".ck-filter-container").css("display")&&(n="none"),e(".ck-filter-container, .modal-overlay").css("display",n)}function r(t){return $inputContainer=e("<div/>").addClass("control-group"),$label=e("<label/>").attr("for","ck-input-"+t.name).addClass("t1-label control-label").text(t.label),$controls=e("<div/>").addClass("controls"),$input=e("<input/>").attr("id","ck-input-"+t.name).attr("type","text").attr("placeholder",t.placeholder).val(t.value),$p=e("<p/>").addClass("notification").text(t.description),$inputContainer.append($label).append($controls.append($input).append($p)),$inputContainer}function l(){t.saveData(),o()}var s=function(){a(),i(),n()};t.initializeEditor=s}(this,jQuery),function(t,e){function n(){var n=e(".stream-items .js-stream-item"),l=t.getData(),s=a(l.words.split(",")),c=a(l.accounts.split(","));n.each(function(){if(!e(this).hasClass("ck-filtered")){var t=e(this).text(),n=t.match(s),a=t.match(c),l="BLOCKED: ";a&&(a=a.filter(i),a=a.filter(o(a)),l+="Accounts: ",l+=a.join(", ")),n&&(n=n.filter(i),n=n.filter(o(n)),l+=" Words: ",l+=n.join(", ")),(a||n)&&r(e(this),l)}}),requestAnimationFrame(filterStream)}function a(t){for(var e="",n=0;n<t.length;n++)e+="("+t[n].trim()+")|";return new RegExp(e.slice(0,-1),"ig")}function i(t){return void 0!==t}function o(t){return function(e,n){return t.indexOf(e)==n}}function r(t,n){var a=e("<div/>").addClass("ck-message").text(n);t.prepend(a).addClass("ck-filtered ck-blocked"),a.on("click",l)}function l(t){t.stopPropagation(),t.preventDefault(),e(this).parent().toggleClass("ck-blocked")}t.filterStream=n}(this,jQuery),function(){!function(){window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}())}(),GM_addStyle(GM_getResourceText("styles")),initializeEditor(),requestAnimationFrame(filterStream)}(jQuery);