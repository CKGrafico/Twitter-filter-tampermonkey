// GPLv2 Licensed
// http://www.gnu.org/licenses/gpl-2.0.html
//
// ==UserScript==
// @name            Twitter-Filter
// @description     Active filter on twitter
// @namespace       http://ckgrafico.com
// @version         0.1.6
// @author          CKGrafico
// @include         https://www.twitter.com*
// @include         https://twitter.com*
// @include         http://www.twitter.com*
// @include         http://twitter.com*
// @resource        styles https://raw.githubusercontent.com/CKGrafico/Twitter-filter-tampermonkey/master/build/min/all.min.css
// @run-at          document-end
// @require         http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js
// ==/UserScript==
!function(t,e){function a(){localStorage.setItem("ckFilters",JSON.stringify({words:e("#ck-input-words").val(),accounts:e("#ck-input-accounts").val()}))}function n(){return localStorage.getItem("ckFilters")?JSON.parse(localStorage.getItem("ckFilters")):{words:"",accounts:""}}t.getData=n,t.saveData=a}(this,jQuery),function(t,e){function a(){e(".ck-filter-close, .ck-filters").on("click",o),e(".ck-save").on("click",l)}function n(){var t=e(".js-global-actions"),a=e("<li/>").addClass("ck-filters"),n=e("<a/>").addClass("js-nav").attr("href","#").attr("title","Filter"),i=e("<span/>").addClass("Icon Icon--newsBadge Icon--large"),o=e("<span/>").addClass("text").text("Filters");a.append(n.append(i).append(o)).appendTo(t)}function i(){var a=t.getData();$container=e("<div/>").addClass("modal-container ck-filter-container"),$close=e("<div/>").addClass("close-modal-background-target ck-filter-close"),$modal=e("<div/>").addClass("modal-content ck-modal-content"),$h2=e("<h2/>").text("Filters configuration"),$save=e("<button/>").addClass("small-follow-btn follow-btn btn small ck-save").text("Save");var n=r({label:"Twitter accounts",name:"accounts",placeholder:"Charles, twitter, hater",description:"Write twitter accounts to exclude, separated by commas",value:a.accounts||""}),i=r({label:"Specific words",name:"words",placeholder:"hello, money, idiot",description:"Write specific words to exclude, separated by commas",value:a.words||""});$modal.append($h2).append(n).append(i).append($save),$container.append($close).append($modal),e("body").append($container)}function o(t){t&&t.preventDefault();var a="block";"block"===e(".ck-filter-container").css("display")&&(a="none"),e(".ck-filter-container, .modal-overlay").css("display",a)}function r(t){return $inputContainer=e("<div/>").addClass("control-group"),$label=e("<label/>").attr("for","ck-input-"+t.name).addClass("t1-label control-label").text(t.label),$controls=e("<div/>").addClass("controls"),$input=e("<input/>").attr("id","ck-input-"+t.name).attr("type","text").attr("placeholder",t.placeholder).val(t.value),$p=e("<p/>").addClass("notification").text(t.description),$inputContainer.append($label).append($controls.append($input).append($p)),$inputContainer}function l(){t.saveData(),o(),location.reload()}var c=function(){n(),i(),a()};t.initializeEditor=c}(this,jQuery),function(t,e){function a(){for(var a=e(".js-stream-item"),l=t.getData(),c=l.words.split(","),s=0;s<c.length;s++)c[s]=c[s].trim();var d=n(c),u=l.accounts.split(",");for(s=0;s<u.length;s++)u[s]=u[s].trim(),u[s]="@"!==u[s][0]?"\\@"+u[s]:u[s];var p=n(u);a.each(function(){if(!e(this).hasClass("ck-filtered")){var t=e(this).text(),a="<b>BLOCKED </b>";if(u.length>0){var n=t.match(p);n&&(n=n.filter(i),n=n.filter(o(n)),a+="Accounts: <i>",a+=n.join(", "),a+="</i>")}if(c.length>0){var l=t.match(d);l&&(l=l.filter(i),l=l.filter(o(l)),a+=" Words: <i>",a+=l.join(", "),a+="</i>")}(n||l)&&r(e(this),a)}}),requestAnimationFrame(filterStream)}function n(t){for(var e="",a=0;a<t.length;a++)e+="("+t[a].trim()+")|";return new RegExp(e.slice(0,-1),"ig")}function i(t){return void 0!==t}function o(t){return function(e,a){return t.indexOf(e)==a}}function r(t,a){var n=e("<div/>").addClass("ck-message").html(a);t.prepend(n).addClass("ck-filtered ck-blocked"),n.on("click",l)}function l(t){t.stopPropagation(),t.preventDefault(),e(this).parent().toggleClass("ck-blocked")}t.filterStream=a}(this,jQuery),function(){!function(){window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}())}(),GM_addStyle(GM_getResourceText("styles")),initializeEditor(),requestAnimationFrame(filterStream)}(jQuery);